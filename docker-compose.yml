services:
  # ── Frontend ─────────────────────────────────────────────────────────────────
  client:
    build: ./client
    container_name: algonote-client
    ports:
      - "80:80"
    depends_on:
      - gateway
    networks:
      - algonote-net

  # ── API Gateway ───────────────────────────────────────────────────────────────
  gateway:
    build: ./backend/gateway
    container_name: algonote-gateway
    ports:
      - "5001:5001"
    environment:
      - PORT=5001
      - FILE_SERVICE_URL=http://file-service:5002
      - PROBLEM_SERVICE_URL=http://problem-service:5003
      - AI_SERVICE_URL=http://ai-service:5004
      - PLAYLIST_SERVICE_URL=http://youtube-playlist-service:5005
      - PROFILE_SERVICE_URL=http://profile-analysis-service:5006
    depends_on:
      - file-service
      - problem-service
      - ai-service
      - youtube-playlist-service
      - profile-analysis-service
    networks:
      - algonote-net

  # ── File Service ──────────────────────────────────────────────────────────────
  file-service:
    build: ./backend/services/file-service
    container_name: algonote-file-service
    ports:
      - "5002:5002"
    environment:
      - PORT=5002
    env_file:
      - .env
    dns:
      - 8.8.8.8
      - 8.8.4.4
    networks:
      - algonote-net

  # ── Problem Service ───────────────────────────────────────────────────────────
  problem-service:
    build: ./backend/services/problem-service
    container_name: algonote-problem-service
    ports:
      - "5003:5003"
    environment:
      - PORT=5003
    env_file:
      - .env
    dns:
      - 8.8.8.8
      - 8.8.4.4
    networks:
      - algonote-net

  # ── AI Service ────────────────────────────────────────────────────────────────
  ai-service:
    build: ./backend/services/ai-service
    container_name: algonote-ai-service
    ports:
      - "5004:5004"
    environment:
      - PORT=5004
    env_file:
      - ./backend/services/ai-service/.env
    networks:
      - algonote-net

  # ── YouTube Playlist Service ──────────────────────────────────────────────────
  youtube-playlist-service:
    build: ./backend/services/youtube-playlist-service
    container_name: algonote-youtube-playlist-service
    ports:
      - "5005:5005"
    environment:
      - PLAYLIST_SERVICE_PORT=5005
    env_file:
      - .env
      - ./backend/services/youtube-playlist-service/.env
    dns:
      - 8.8.8.8
      - 8.8.4.4
    networks:
      - algonote-net

  # ── Profile Analysis Service ──────────────────────────────────────────────────
  profile-analysis-service:
    build: ./backend/services/profile-analysis-service
    container_name: algonote-profile-analysis-service
    ports:
      - "5006:5006"
    environment:
      - PROFILE_SERVICE_PORT=5006
    env_file:
      - ./backend/services/profile-analysis-service/.env
    networks:
      - algonote-net

networks:
  algonote-net:
    driver: bridge
